"use strict";(self.webpackChunkreact_ant_app=self.webpackChunkreact_ant_app||[]).push([[240],{1244:function(e,t,n){n.d(t,{db:function(){return u}});var i=n(1413),s=n(3144),a=n(5671),r=n(136),o=n(7277),c=n(1447),l={todoList:"++id, context, isCompleted"},d={chatList:"++id, title",chatItem:"++id, chatListId, from, text"},u=new(function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.call(this,"AppDB")).todoList=void 0,e.chatList=void 0,e.chatItem=void 0,e.version(2).stores((0,i.Z)((0,i.Z)({},l),d)),e}return(0,s.Z)(n)}(c.default))},5240:function(e,t,n){n.r(t),n.d(t,{default:function(){return E}});var i=n(4165),s=n(5861),a=n(9439),r=n(2791),o=n(7309),c=n(4219),l=n(6492),d=n(9286),u=n(2616),h=n(9529),f=n(3097),m=n(1244),p=n(3327),x=n(1115),v=new x.Configuration({organization:"org-YuIRgm8UHndqVksAj5YXuIop",apiKey:"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"}),Z=new x.OpenAIApi(v),j=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,r,o,c,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.createCompletion({model:"text-davinci-003",prompt:"".concat(t),max_tokens:100,temperature:.5});case 2:return n=e.sent,s="",console.log(n),s=n.data.choices?null!==(a=null===(r=n.data.choices[0])||void 0===r?void 0:r.text)&&void 0!==a?a:"":null!==(o=null===(c=n.data)||void 0===c||null===(l=c.error)||void 0===l?void 0:l.message)&&void 0!==o?o:"",e.abrupt("return",Promise.resolve({data:s}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=n(4809),b=n(5796),y=n(6864),I=n(1938),w=n(1752),k=n(2622),g=n(1413),N=n(8185),L=n(3099),P=n(184),S={wrapperCol:{offset:16,span:8}},F=function(e){var t=e.inputValue,n=e.updateId,i=e.isShow,s=e.resetTemp,l=N.Z.useForm(),d=(0,a.Z)(l,1)[0];(0,r.useEffect)((function(){d.setFieldsValue({title:t})}),[t,i]);return(0,P.jsx)(C.Z,{forceRender:!0,title:"\u7de8\u8f2fTitle",open:i,onCancel:s,footer:[],children:(0,P.jsxs)(N.Z,{name:"basic",form:d,labelCol:{span:4},wrapperCol:{span:20},style:{maxWidth:600},initialValues:{remember:!0},onFinish:function(e){var t=e.title,i=void 0===t?"":t;m.db.chatList.update(n,{title:i}),d.resetFields(),s()},onFinishFailed:function(e){console.log("Failed:",e)},autoComplete:"off",children:[(0,P.jsx)(N.Z.Item,{label:"Title",name:"title",rules:[{required:!0,message:"Please input title!"}],children:(0,P.jsx)(c.Z,{})}),(0,P.jsx)(N.Z.Item,(0,g.Z)((0,g.Z)({},S),{},{children:(0,P.jsxs)(L.Z,{children:[(0,P.jsx)(o.ZP,{type:"default",htmlType:"reset",children:"Reset"}),(0,P.jsx)(o.ZP,{type:"primary",htmlType:"submit",children:"Submit"})]})}))]})})},T=C.Z.confirm,A=function(e){var t=(0,r.useState)(!0),n=(0,a.Z)(t,2),i=n[0],s=n[1],c=(0,r.useState)(!1),l=(0,a.Z)(c,2),u=l[0],h=l[1],f=(0,r.useState)(0),p=(0,a.Z)(f,2),x=p[0],v=p[1],Z=(0,r.useState)(""),j=(0,a.Z)(Z,2),C=j[0],g=j[1],N=e.chatList,L=e.addList,S=e.currentChatId,A=e.setCurrentChatId;return(0,P.jsxs)("div",{className:"chat-side ".concat(i?"is-open":""),children:[(0,P.jsx)(o.ZP,{className:"side-collapse ".concat(i?"is-open":""),icon:i?(0,P.jsx)(y.Z,{}):(0,P.jsx)(I.Z,{}),onClick:function(){s((function(e){return!e}))}}),(0,P.jsx)(o.ZP,{ghost:!0,icon:(0,P.jsx)(d.Z,{}),className:"side-new",onClick:L,children:"New Chat"}),(0,P.jsx)(F,{inputValue:C,updateId:x,isShow:u,resetTemp:function(){h(!1),v(0),g("")}}),(0,P.jsx)("ul",{className:"side-list",children:N.map((function(e,t){return(0,P.jsxs)("li",{className:"side-item ".concat(e.id===S?"active":""),onClick:function(){var t;return A(null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:0)},children:[(0,P.jsx)("div",{className:"side-item-title",children:e.title}),(0,P.jsxs)("div",{className:"side-item-button",children:[(0,P.jsx)(o.ZP,{type:"text",size:"small",icon:(0,P.jsx)(w.Z,{style:{color:"#ffffff"}}),onClick:function(n){return function(e,t){e.stopPropagation();var n=t.id,i=t.title;v(null!==n&&void 0!==n?n:0),g(i),h(!0)}(n,{id:e.id,index:t,title:e.title})}}),(0,P.jsx)(o.ZP,{type:"text",size:"small",icon:(0,P.jsx)(k.Z,{style:{color:"#ffffff"}}),onClick:function(n){return function(e,t){e.stopPropagation();var n=t.id,i=t.title;T({icon:(0,P.jsx)(b.Z,{}),content:(0,P.jsxs)("div",{children:["\u78ba\u5b9a\u522a\u9664 ",i]}),onOk:function(){"number"===typeof n&&(m.db.chatList.delete(n),m.db.chatItem.where({id:n}).delete())},onCancel:function(){}})}(n,{id:e.id,index:t,title:e.title})}})]})]},e.id)}))})]})},E=function(){var e=(0,p.useLiveQuery)((function(){return m.db.chatList.toArray()})),t=(0,r.useMemo)((function(){return null!==e&&void 0!==e?e:[]}),[e]),n=(0,r.useState)(0),x=(0,a.Z)(n,2),v=x[0],Z=x[1],C=(0,p.useLiveQuery)((function(){return m.db.chatItem.toArray()})),b=(0,r.useMemo)((function(){return null!==C&&void 0!==C?C:[]}),[C]),y=(0,r.useState)(""),I=(0,a.Z)(y,2),w=I[0],k=I[1],g=(0,r.useState)(!1),N=(0,a.Z)(g,2),L=N[0],S=N[1],F=function(){m.db.chatList.add({title:"This is New Chat"})},T=function(){E||""===w||(S(!1),m.db.chatItem.add({chatListId:v,from:"user",text:w}).then((0,s.Z)((0,i.Z)().mark((function e(){var t,n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(w);case 2:t=e.sent,n=t.data,s=void 0===n?"":n,m.db.chatItem.add({chatListId:v,from:"ai",text:s}).then((function(){k(""),S(!0)}));case 6:case"end":return e.stop()}}),e)})))))};(0,r.useEffect)((function(){var e,n=0;t.length>0&&(n=null!==(e=t[t.length-1].id)&&void 0!==e?e:0);Z(n)}),[t]);var E=(0,r.useMemo)((function(){var e=t.length<=0;return S(!e),e}),[t]),V=(0,r.useMemo)((function(){return b.filter((function(e){return e.chatListId===v}))}),[v,b]);return(0,r.useEffect)((function(){!function(){var e=V.length,t=document.querySelector('li[scroll-key="'.concat(e,'"]'));null===t||void 0===t||t.scrollIntoView({behavior:"smooth",block:"end"})}()}),[b]),(0,P.jsxs)("div",{className:"chat-container",children:[(0,P.jsx)(A,{chatList:t,addList:F,currentChatId:v,setCurrentChatId:Z}),(0,P.jsxs)("div",{className:"chat-main",children:[E?(0,P.jsxs)("div",{className:"main-empty",children:[(0,P.jsx)("h3",{children:"Chat is Empty"}),(0,P.jsx)(o.ZP,{shape:"round",type:"primary",icon:(0,P.jsx)(d.Z,{}),onClick:F,children:"New Chat"})]}):(0,P.jsx)("ul",{className:"main-list",children:V.map((function(e,t){return(0,P.jsxs)("li",{className:"main-item","scroll-key":t+1,children:[(0,P.jsx)("div",{className:"main-icon",children:"ai"===e.from?(0,P.jsx)(u.Z,{style:{color:"#52c41a"}}):(0,P.jsx)(h.Z,{style:{color:"#faad14"}})}),(0,P.jsx)("div",{className:"main-text",children:e.text})]},e.id)}))}),(0,P.jsxs)("div",{className:"main-submit",children:[(0,P.jsxs)(c.Z.Group,{compact:!0,children:[(0,P.jsx)(c.Z,{value:w,style:{width:"calc(100% - 40px)"},size:"large",disabled:!L,onChange:function(e){k(e.target.value)},onPressEnter:T}),(0,P.jsx)(l.Z,{title:"send",children:(0,P.jsx)(o.ZP,{icon:(0,P.jsx)(f.Z,{}),size:"large",disabled:!L,onClick:T})})]}),L||E?(0,P.jsx)("div",{}):(0,P.jsx)("div",{className:"main-wait",children:"waitting for openAi to respond"})]})]})]})}}}]);
//# sourceMappingURL=240.b620c5e0.chunk.js.map