"use strict";(self.webpackChunkreact_ant_app=self.webpackChunkreact_ant_app||[]).push([[240],{1244:function(e,t,n){n.d(t,{db:function(){return d}});var i=n(1413),s=n(3144),a=n(5671),r=n(136),c=n(7277),o=n(1447),l={todoList:"++id, context, isCompleted"},u={chatList:"++id, title",chatItem:"++id, chatListId, from, text"},d=new(function(e){(0,r.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.call(this,"AppDB")).todoList=void 0,e.chatList=void 0,e.chatItem=void 0,e.version(2).stores((0,i.Z)((0,i.Z)({},l),u)),e}return(0,s.Z)(n)}(o.default))},5240:function(e,t,n){n.r(t),n.d(t,{default:function(){return A}});var i=n(4165),s=n(5861),a=n(9439),r=n(2791),c=n(7309),o=n(4219),l=n(6492),u=n(9286),d=n(2616),h=n(9529),f=n(3097),m=n(1244),p=n(3327),x=n(1115),v=new x.Configuration({organization:"org-YuIRgm8UHndqVksAj5YXuIop",apiKey:"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"}),Z=new x.OpenAIApi(v),j=function(){var e=(0,s.Z)((0,i.Z)().mark((function e(t){var n,s,a,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z.createCompletion({model:"text-davinci-003",prompt:"".concat(t),max_tokens:100,temperature:.5});case 3:return a=e.sent,e.abrupt("return",{data:null!==(n=null===(s=a.data.choices[0])||void 0===s?void 0:s.text)&&void 0!==n?n:""});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{data:null!==(r=null===e.t0||void 0===e.t0?void 0:e.t0.message)&&void 0!==r?r:"error"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),C=n(4809),y=n(5796),b=n(6864),w=n(1938),I=n(1752),k=n(2622),N=n(1413),g=n(8185),L=n(3099),P=n(184),S={wrapperCol:{offset:16,span:8}},T=function(e){var t=e.inputValue,n=e.updateId,i=e.isShow,s=e.resetTemp,l=g.Z.useForm(),u=(0,a.Z)(l,1)[0];(0,r.useEffect)((function(){u.setFieldsValue({title:t})}),[t,i]);return(0,P.jsx)(C.Z,{forceRender:!0,title:"\u7de8\u8f2fTitle",open:i,onCancel:s,footer:[],children:(0,P.jsxs)(g.Z,{name:"basic",form:u,labelCol:{span:4},wrapperCol:{span:20},style:{maxWidth:600},initialValues:{remember:!0},onFinish:function(e){var t=e.title,i=void 0===t?"":t;m.db.chatList.update(n,{title:i}),u.resetFields(),s()},onFinishFailed:function(e){console.log("Failed:",e)},autoComplete:"off",children:[(0,P.jsx)(g.Z.Item,{label:"Title",name:"title",rules:[{required:!0,message:"Please input title!"}],children:(0,P.jsx)(o.Z,{})}),(0,P.jsx)(g.Z.Item,(0,N.Z)((0,N.Z)({},S),{},{children:(0,P.jsxs)(L.Z,{children:[(0,P.jsx)(c.ZP,{type:"default",htmlType:"reset",children:"Reset"}),(0,P.jsx)(c.ZP,{type:"primary",htmlType:"submit",children:"Submit"})]})}))]})})},F=C.Z.confirm,E=function(e){var t=(0,r.useState)(!0),n=(0,a.Z)(t,2),i=n[0],s=n[1],o=(0,r.useState)(!1),l=(0,a.Z)(o,2),d=l[0],h=l[1],f=(0,r.useState)(0),p=(0,a.Z)(f,2),x=p[0],v=p[1],Z=(0,r.useState)(""),j=(0,a.Z)(Z,2),C=j[0],N=j[1],g=e.chatList,L=e.addList,S=e.currentChatId,E=e.setCurrentChatId;return(0,P.jsxs)("div",{className:"chat-side ".concat(i?"is-open":""),children:[(0,P.jsx)(c.ZP,{className:"side-collapse ".concat(i?"is-open":""),icon:i?(0,P.jsx)(b.Z,{}):(0,P.jsx)(w.Z,{}),onClick:function(){s((function(e){return!e}))}}),(0,P.jsx)(c.ZP,{ghost:!0,icon:(0,P.jsx)(u.Z,{}),className:"side-new",onClick:L,children:"New Chat"}),(0,P.jsx)(T,{inputValue:C,updateId:x,isShow:d,resetTemp:function(){h(!1),v(0),N("")}}),(0,P.jsx)("ul",{className:"side-list",children:g.map((function(e,t){return(0,P.jsxs)("li",{className:"side-item ".concat(e.id===S?"active":""),onClick:function(){var t;return E(null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:0)},children:[(0,P.jsx)("div",{className:"side-item-title",children:e.title}),(0,P.jsxs)("div",{className:"side-item-button",children:[(0,P.jsx)(c.ZP,{type:"text",size:"small",icon:(0,P.jsx)(I.Z,{style:{color:"#ffffff"}}),onClick:function(n){return function(e,t){e.stopPropagation();var n=t.id,i=t.title;v(null!==n&&void 0!==n?n:0),N(i),h(!0)}(n,{id:e.id,index:t,title:e.title})}}),(0,P.jsx)(c.ZP,{type:"text",size:"small",icon:(0,P.jsx)(k.Z,{style:{color:"#ffffff"}}),onClick:function(n){return function(e,t){e.stopPropagation();var n=t.id,i=t.title;F({icon:(0,P.jsx)(y.Z,{}),content:(0,P.jsxs)("div",{children:["\u78ba\u5b9a\u522a\u9664 ",i]}),onOk:function(){"number"===typeof n&&(m.db.chatList.delete(n),m.db.chatItem.where({id:n}).delete())},onCancel:function(){}})}(n,{id:e.id,index:t,title:e.title})}})]})]},e.id)}))})]})},A=function(){var e=(0,p.useLiveQuery)((function(){return m.db.chatList.toArray()})),t=(0,r.useMemo)((function(){return null!==e&&void 0!==e?e:[]}),[e]),n=(0,r.useState)(0),x=(0,a.Z)(n,2),v=x[0],Z=x[1],C=(0,p.useLiveQuery)((function(){return m.db.chatItem.toArray()})),y=(0,r.useMemo)((function(){return null!==C&&void 0!==C?C:[]}),[C]),b=(0,r.useState)(""),w=(0,a.Z)(b,2),I=w[0],k=w[1],N=(0,r.useState)(!1),g=(0,a.Z)(N,2),L=g[0],S=g[1],T=function(){m.db.chatList.add({title:"This is New Chat"})},F=function(){A||""===I||(S(!1),m.db.chatItem.add({chatListId:v,from:"user",text:I}).then((0,s.Z)((0,i.Z)().mark((function e(){var t,n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(I);case 2:t=e.sent,n=t.data,s=void 0===n?"":n,m.db.chatItem.add({chatListId:v,from:"ai",text:s}).then((function(){k(""),S(!0)}));case 6:case"end":return e.stop()}}),e)})))))};(0,r.useEffect)((function(){var e,n=0;t.length>0&&(n=null!==(e=t[t.length-1].id)&&void 0!==e?e:0);Z(n)}),[t]);var A=(0,r.useMemo)((function(){var e=t.length<=0;return S(!e),e}),[t]),V=(0,r.useMemo)((function(){return y.filter((function(e){return e.chatListId===v}))}),[v,y]);return(0,r.useEffect)((function(){!function(){var e=V.length,t=document.querySelector('li[scroll-key="'.concat(e,'"]'));null===t||void 0===t||t.scrollIntoView({behavior:"smooth",block:"end"})}()}),[y]),(0,P.jsxs)("div",{className:"chat-container",children:[(0,P.jsx)(E,{chatList:t,addList:T,currentChatId:v,setCurrentChatId:Z}),(0,P.jsxs)("div",{className:"chat-main",children:[A?(0,P.jsxs)("div",{className:"main-empty",children:[(0,P.jsx)("h3",{children:"Chat is Empty"}),(0,P.jsx)(c.ZP,{shape:"round",type:"primary",icon:(0,P.jsx)(u.Z,{}),onClick:T,children:"New Chat"})]}):(0,P.jsx)("ul",{className:"main-list",children:V.map((function(e,t){return(0,P.jsxs)("li",{className:"main-item","scroll-key":t+1,children:[(0,P.jsx)("div",{className:"main-icon",children:"ai"===e.from?(0,P.jsx)(d.Z,{style:{color:"#52c41a"}}):(0,P.jsx)(h.Z,{style:{color:"#faad14"}})}),(0,P.jsx)("div",{className:"main-text",children:e.text})]},e.id)}))}),(0,P.jsxs)("div",{className:"main-submit",children:[(0,P.jsxs)(o.Z.Group,{compact:!0,children:[(0,P.jsx)(o.Z,{value:I,style:{width:"calc(100% - 40px)"},size:"large",disabled:!L,onChange:function(e){k(e.target.value)},onPressEnter:F}),(0,P.jsx)(l.Z,{title:"send",children:(0,P.jsx)(c.ZP,{icon:(0,P.jsx)(f.Z,{}),size:"large",disabled:!L,onClick:F})})]}),L||A?(0,P.jsx)("div",{}):(0,P.jsx)("div",{className:"main-wait",children:"waitting for openAi to respond"})]})]})]})}}}]);
//# sourceMappingURL=240.41ce8079.chunk.js.map